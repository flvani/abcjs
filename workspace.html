<html>
    <head>
	<title>Draw The Dots: Tune Editor</title>
        <meta name="viewport" content="width=device-width, initial-scale=0.8, minimum-scale=0.8, maximum-scale=2.0" />
        <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
        <link rel="icon" type="image/icon" href="images/favicon.ico" />
        
        <link rel="stylesheet" href="fontsIco/abcx.css" />
        <link rel="stylesheet" href="fontsIco/abcx-window-font.css" />
        <link rel="stylesheet" href="fontsGoogle/fonts.css" />
        
        <link rel="stylesheet" href="css/dropdown-menu.css" />
        <link rel="stylesheet" href="css/tabbed-view.css" />
        <link rel="stylesheet" href="css/draggable.css" >
        
        <link rel="stylesheet" href="css/workspace.css" />
        
            <!-- 
          MAIN DATA STRUCTURES
        
            Tune
              midi {}
              lines[]
                staffs[]
                   voices[]

            Printer
              layouter  Layout {}
              staffgroups[] Staffgroup {}

            Layout 
              Staffgroup {}
                 voices[]
                   beams[]
                   children[]
                   otherchildren[]
                   stave {}

            stave {}
               y
               top
               bottom
               highest
               lowest
        
           DONE:
             Verificar o transporte de keys com modos min e maj
             Verificar os limites máximo e mínimos para transporte de keys
             Ignorar Accents na transposição
             Verificar o espaçamento para os jump markers
             barsperstaff: ao dividir a linha decidir onde fica jumpinfo e barnumbers
             Verificar durante o parse e incluir o barnumber na barra correta
             Tablatura: gerar mesmo sem o baixo
             Layout:    Revisar a impressão dos elementos ending, accents e lyrics
             Layout:    Revisar a de linhas de texto, quando há mais de uma linha
             Layout:    Imprimir ao final da staff alguns jump markers
             Tablatura: imprimir os de pausas adequadamente no baixo
             Tablatura: parse
                tratar numeros hexa
                tratar a adicao de pausas - continuacao
                tratar acordes
                tratar startChar e endChar
                registar o parse da tablatura
                gerar a linha durante a inferencia
                imprimir baseado na linha existente
                melhorar a relação open/close do fole na melodia
                revisar a impressão de múltiplas notas na mesma coluna
                Verificar durante o parse e incluir o barnumber na barra correta
             MIDI PARSER
                Bug: falta informação de barra de compasso para didatic play measure e goto-measure
                Bug: manter a informação de passadas quando existe um salto originado em compassos que estão debaixo da casa 1 (ending)
        
           TODO:
             EDITOR: 
                Bug: transposição de acordes de baixo
                Melhorar a transposição dos baixos, mantendo na oitava correta
             Tablatura: 
                tratar adequadamente os acordes (de baixo)      
                promover a inversão do fole se a posição do botao for melhor
        
        -->
    </head>
    <body>

	<script type="text/javascript" src="proto_noconflict.js" ></script>
        <script type="text/javascript" src="jquery/jquery-1.11.1.min.js" ></script>
        
        <!-- suporte a MIDI -->
        <script type="text/javascript" src="MIDI.js/MIDI_3.00-min.js"></script>

        <script type="text/javascript" src="svg/svg.js" ></script>
        <script type="text/javascript" src="svg/glyphs.js" ></script>
        
        <script type="text/javascript" src="draggable/draggable.js"></script>
        
        <script type="text/javascript" src="dropdown-menu/dropdown.js"></script>
        
        <script type="text/javascript" src="file/filemanager.js" ></script>

        <script type="text/javascript" src="api/abc_tunebook.js" ></script>
        
        <script type="text/javascript" src="data/abc_tune.js" ></script>
        
	<script type="text/javascript" src="parse/abc_common.js" ></script>
        <script type="text/javascript" src="parse/abc_parse_header.js" ></script>
	<script type="text/javascript" src="parse/abc_tokenizer.js" ></script>
	<script type="text/javascript" src="parse/abc_parse_key_voice.js" ></script>
	<script type="text/javascript" src="parse/abc_parse_directive.js" ></script>
        <script type="text/javascript" src="parse/abc_parse.js" ></script>
        <script type="text/javascript" src="parse/abc_transposer.js" ></script>

        <script type="text/javascript" src="midi/midi_common.js" ></script>
        <script type="text/javascript" src="midi/midi_parser.js" ></script>
        <script type="text/javascript" src="midi/midi_player.js" ></script>

        <script type="text/javascript" src="write/sprintf.js" ></script>
        <script type="text/javascript" src="write/abc_glyphs.js" ></script>
        <script type="text/javascript" src="write/abc_graphelements.js" ></script>
        <script type="text/javascript" src="write/abc_layout.js" ></script>
        <script type="text/javascript" src="write/abc_write.js" ></script>

        <!-- diatonic accordion map -->
        <script type="text/javascript" src="diatonic/diatonic_common.js"></script>
        <script type="text/javascript" src="diatonic/diatonic_accordion_map.js"></script>
        <script type="text/javascript" src="diatonic/diatonic_keyboard.js"></script>
        <script type="text/javascript" src="diatonic/diatonic_button.js"></script>
        
        <!-- support for diatonic accordion tablature -->
        <script type="text/javascript" src="tablature/tablature_accordion.js"></script>
        <script type="text/javascript" src="tablature/tablature_accordion_infer.js"></script>
        <script type="text/javascript" src="tablature/tablature_accordion_parse.js"></script>
        <script type="text/javascript" src="tablature/tablature_accordion_layout.js"></script>
        
        <script type="text/javascript" src="ace/src/ace.js" ></script>
 	<script type="text/javascript" src="edit/abc_selectors.js" ></script>
 	<script type="text/javascript" src="edit/abc_editarea.js" ></script>
 	<script type="text/javascript" src="edit/abc_editor.js" ></script>
        
        <!--                     menor
            C,,   C,  E,  G,     C,  ^D,  G,
            D,,   D, ^F,  A,     D,   F,  A,
            E,,   E, ^G,  B,     E,   G,  B,
            F,,   F,  A,  C      F,  ^G,  C
            G,,   G,  B,  D      G,  ^A,  D
            A,,   A, ^C   E      A,   C   E
            B,,   B, ^D  ^F      B,   D  ^F
            Bb,,  Bb, D   F      Bb, ^C   F
        -->    
    

    
<textarea id="svg_source" class="abc_textarea" spellcheck="false" cols="120" rows="10" style="display: none;" >
</textarea>
    
<textarea class="abc_textarea" spellcheck="false" id="abc" cols="120" rows="10"  style="display: none;">
X:1006 %isto é um comentario.
%isto também é um comentario.
%%barnumbers 1 %isto também é um comentario.
%%papersize A4
%%landscape
T:Hino do Grêmio %isto também é um comentario.
C:Lupicínio Rodrigues
C:(<a class="abc_link" href=https://www.facebook.com/groups/toquegaitaponto/?fref=nf target=_blank>arr. Cezar Ferreira</a>)
Z:Flávio Vani
N:Mapa para Acordeons Diatônicos powered by ABCXJS.
F:https://www.youtube-nocookie.com/embed/J7cWbUVw97c
L:1/8
Q:140
M:4/4
K:C
V:melodia clef=treble stem=up
[V:melodia] |: [P:Parte 1] +segno+ "C" g2 e3/2d1/2 c2 d3/2e1/2 | "G" d2 G4 z2 | "C" g2 e3/2d1/2 c2 d3/2e1/2 | "G" d4 z2 e3/2f1/2 |
w:A- té a pé nós i-re-mos Pa ra o que der e vier Mas o 
[V:melodia] |"C" g2 ^f3/2g1/2 "C5+" a2 g3/2a1/2 | "Dm" b2 a2 z2 e3/2f1/2 | "C" g2 a3/2g1/2 "G" d2 f3/2e1/2 | "C" c6 z2 +fine+ :|
w:cer-to é que nós es-ta-remos Com o Grêmio onde o Grêmio es-ti-ver
V:baixo clef=bass
|: C,2 [C,E,G,]2 C,2 [C,E,G,]2 | G,,2 [G,B,d,]2 G,,2 [G,B,d,]2 |  C,2 [C,E,G,]2 C,2 [C,E,G,]2 | G,,2 [G,B,d,]2 G,,2 [G,B,d,]2 |
| C,2z2 A,,2z2 | F,,2 [F,A,c,]2 F,,2 [F,A,c,]2 | C,,2 [G,B,d,]2 G,,2 [G,B,d,]2 |  C,2 [C,E,G,]2 C,2 [C,E,G,]2 :|
V:tab clef=accordionTab
|: C+92 c+7'1.5 >+80.5 C+6'2 c+81.5 >+7'0.5 | G-7'2 g-5'2 G->2 g-z2 | C+92 c+7'1.5 >+80.5 C+6'2 c+81.5 >+7'0.5 | G-7'2 g->2 G-z2 g-91.5 >-8'0.5 |
| C+8'2 z-a1.5 z-9'0.5 A-b2 z-9'1.5 z-b0.5 | F-a'2 f-b2 F-z2 f-91.5 >-8'0.5 | C+8'2 g-b1.5 >-9'0.5 G-7'2 g-8'1.5 >-90.5 | C+6'2 c+>2 C+>2 c+z2 :|
</textarea>
    
<textarea id="abcd" class="abc_textarea" spellcheck="false" cols="120" rows="10"  style="display: none;">
X:2020
%%barnumbers 1
%%papersize A4
%%pagenumbering
%%staffsep 20
%barsperstaff 4
T:Baile de Candieiro (club)
R:rancheira
Z:Flávio Vani
L:1/8
M:3/4
Q:130
K:F
V:1 clef=treble
| C4 |!segno! D4 |: E4 | F4 !dacoda! |1 G4 !dsalcoda!:|2 C4 | !coda!G4 |
%teste13 - workaround  || C4 | !segno! D4 | E4 |!dacoda! e4 | F4 | !dsalcoda! f4 |!coda! G4 | A4 !fine!|
%| C4 | !segno! D4 | E4 | e4 |1 F4 | !dsalfine! f4 |2 G4 | A4 !fine!|
%teste12 | C4 | !segno! D4 | E4 | e4 | F4 |1 !dsalfine! f4 |2 G4 | A4 !fine!|
%teste11 | C4 | !segno! D4 | E4 !dacoda!| e4 | F4 | f4 | G4 | A4 !dsalcoda!|
%teste10 | C4 | !segno! D4 | E4 !dacoda!| e4 | F4 | f4 !coda!| G4 | A4 !dsalcoda!|
%teste09 | C4 |:!segno! D4 | E4 :|: F4 !fine!| G4 :| A4 !dsalfine!|
%teste08 | C4 |:!segno! D4 | E4 :|: F4 | G4 :| A4 !dasegno!|
%teste07 | C4 |: D4 | E4 :|: F4 | G4 :| A4 !dacapo!|
%teste06 |: D4 | ^D4 |1 E4 :|2 F4 | G4 |1 ^G4 :|2 A4 | B4 |
%teste05 |: D4 | ^D4 | E4 :| F4 | G4 | ^G4 :| A4 | B4 |
%teste04 | C4 |: D4 |1 E4 :|2 F4 | G4 :| A4 |
%teste03 | C4 |: D4 | E4 :| F4 | G4 :| A4 |
%teste02 | C4 |: D4 | E4 :|: F4 | G4 :| A4 |
%teste01 | C4 |: D4 | E4 :| F4 |
</textarea>
    
    
<textarea id="abcc" class="abc_textarea" spellcheck="false" cols="120" rows="10"  style="display: none;">
X:1015
%%papersize A4
%%barnumbers 0
%%pagenumbering
%%score (0 1) 2 3
T:Rincão dos Maciel
C:Reduzino Malaquias
Z:Flávio Vani
N:Mapa para Acordeons Diatônicos powered by ABCXJS.
F:https://www.youtube-nocookie.com/embed/QtQzhLMd6tA
L:1/16
Q:78
M:2/4
K:G
V:0 treble stem=up
V:1 treble
V:2 bass
[V:0]|x8[|!segno!x8|x8|x8|x8|x8|x8| %1
[V:1]|[dBG]4 zdBG [| GeGd GeGd | FcFc FfFe | FcFc FfFe | GeGd GbGg | GeGd GeGd | FdFc FfFe | 
[V:2]| z8 [| G,,3[G,B,D] G,,2[G,B,D]2 | D,,3[D,F,A,] D,,2[D,F,A,]2 | D,,3[D,F,A,] D,,2[D,F,A,]2 | G,,3[G,B,D] G,,2[G,B,D]2 | G,,3[G,B,D] G,,2[G,B,D]2 | D,,3[D,F,A,] D,,2[D,F,A,]2 |
[V:0]|x8|x8|x8|x8|x8|x8|x8| %2
[V:1]|[dF]2[cF]2 B2[Ac]2 | [BG]2  gb gbgb | gbdg BdGB | FdFc FfFe | FdFc FfFe| GeGd GbGg | GeGd GeGd |
[V:2]| D,,3[D,F,A,] D,,2[D,F,A,]2 | G,,3[G,B,D] G,,2[G,B,D]2 | G,,3[G,B,D] G,,2[G,B,D]2 | D,,3[D,F,A,] D,,2[D,F,A,]2 | D,,3[D,F,A,] D,,2[D,F,A,]2 | G,,3[G,B,D] G,,2[G,B,D]2 | G,,3[G,B,D] G,,2[G,B,D]2 |
[V:0]|x8|x8|x8|x8|x8|x8|x8| %3
[V:1]|FdFc FfFe | edcd b2[ac]2 | [Bg]2gb gbgb | gbdg BdGB | [DD,]2F,A, D2C2- | CD,F,A, D4- | DD,G,B, D4-| 
[V:2]| D,,3[D,F,A,] D,,2[D,F,A,]2 | D,,3[D,F,A,] D,,2[D,F,A,]2 | G,,3[G,B,D] G,,2[G,B,D]2 | G,,3[G,B,D] G,,2[G,B,D]2 | D,,3[D,F,A,] D,,2[D,F,A,]2 | D,,3[D,F,A,] D,,2[D,F,A,]2 | G,,3[G,B,D] G,,2[G,B,D]2 |
[V:0]|x8|x8|x8|x8!dacoda!||x8|x8|x8| %4
[V:1]|DD,G,B, D4- | DD,G,B, D2C2- | CD,F,A, D2C2 | B,2[DG]2 z B,CD || [DB]2[Ec]2[DB]2d2- | dD,F,A, D2C2- |CD,F,A, D2C2- | 
[V:2]| G,,3[G,B,D] G,,2[G,B,D]2 | D,,3[D,F,A,] D,,2[D,F,A,]2 | D,,3[D,F,A,] D,,2[D,F,A,]2 | G,,3[G,B,D] G,,2[G,B,D]2 || G,,3[G,B,D] G,,2[G,B,D]2 | D,,3[D,F,A,] D,,2[D,F,A,]2 | D,,3[D,F,A,] D,,2[D,F,A,]2 |
[V:0]|x8|x8|x8|x8|x8|:x8|d8-|d8| %5
[V:1]|CD,G,B, D4- | DD,G,B, D4- | DD,G,B, D2C2- | CD,F,A, D2C2 | B,2[DG]2 z B,CD |: [DB]2[Ec]2[DB]2d2 | A2C2A,2C2 | D2C2B,2A,2 |
[V:2]| G,,3[G,B,D] G,,2[G,B,D]2 | G,,3[G,B,D] G,,2[G,B,D]2 | D,,3[D,F,A,] D,,2[D,F,A,]2 | D,,3[D,F,A,] D,,2[D,F,A,]2 | G,,3[G,B,D] G,,2[G,B,D]2 |: G,,3[G,B,D] G,,2[G,B,D]2 | D,,3[D,F,A,] D,,2[D,F,A,]2 |D,,3[D,F,A,] D,,2[D,F,A,]2 |
[V:0]|d8-|d8|d8-|d8|1 x8 :|2 !dsalcoda! x8 !coda! | x8| %6
[V:1]| G,2D2B,2C2 | E2D2C2B,2 | A,2C2A,2C2 |D2C2B,2A,2 |1 B,2[B,DG]2 z B,CD :|2 B,2[B,DG]2 z dBG | [DB]2[Ec]2[DB]2d2 |
[V:2]| G,,3[G,B,D] G,,2[G,B,D]2 | G,,3[G,B,D] G,,2[G,B,D]2 | D,,3[D,F,A,] D,,2[D,F,A,]2 | D,,3[D,F,A,] D,,2[D,F,A,]2 |1 G,,3[G,B,D] G,,2[G,B,D]2 :|2 G,,3[G,B,D] G,,2[G,B,D]2 | G,,3[G,B,D] G,,2[G,B,D]2 | 
[V:0]|d8-|d8|d8-|d8|d8-|d8| x8|x8| %7
[V:1]| A,2C2 A,A,CC | D2CC  B,B,A,A, | G,2D2 B,B,DD | EED2 C2B,B, | A,2C2 A,A,CC | D2C2B,2A,2 | B,2[DG]2 z B,CD | [DB]2[Ec]2[DB]2d2 |
[V:2]| D,,3[D,F,A,] D,,2[D,F,A,]2 | D,,3[D,F,A,] D,,2[D,F,A,]2 | G,,3[G,B,D] G,,2[G,B,D]2 | G,,3[G,B,D] G,,2[G,B,D]2 | D,,3[D,F,A,] D,,2[D,F,A,]2 | D,,3[D,F,A,] D,,2[D,F,A,]2 | G,,3[G,B,D] G,,2[G,B,D]2 | G,,3[G,B,D] G,,2[G,B,D]2 |
[V:0]|d8-|d8|d8-|d8|d8-|d8|x8|x8| %8
[V:1]| A,2C2A,2C2 | D2C2B,2A,2 | G,2D2B,2C2 | E2D2C2B,2 | A,2C2A,2C2 |D2C2B,2A,2 | B,2[B,DG]2 z gdB | [GBe]2[GBd]2[GBe]2[GBd]2 |
[V:2]| D,,3[D,F,A,] D,,2[D,F,A,]2 | D,,3[D,F,A,] D,,2[D,F,A,]2 | G,,3[G,B,D] G,,2[G,B,D]2 | G,,3[G,B,D] G,,2[G,B,D]2 | D,,3[D,F,A,] D,,2[D,F,A,]2 | D,,3[D,F,A,] D,,2[D,F,A,]2 | G,,3[G,B,D] G,,2[G,B,D]2 | G,,3[G,B,D] G,,2[G,B,D]2 |
[V:0]|x8|x8|x8|x8| x8|x8|x8|x8| %9
[V:1]| [FAd]2[Fc]2[FAf]2[Gce]2 | [FAd]2[Fc]2[FAf]2[Gce]2 | [GBe]2[Gd]2[GBd]2[Gdg]2| [GBe]2[GBd]2[GBe]2[GBd]2|[FAd]2[Fc]2[FAf]2[Ge]2 | (3ded ^cd [db]2[=ca]2 | [Bg]2gb gbgb | gbdg BdGB |
[V:2]| D,,3[D,F,A,] D,,2[D,F,A,]2 | D,,3[D,F,A,] D,,2[D,F,A,]2 | G,,3[G,B,D] G,,2[G,B,D]2 | G,,3[G,B,D] G,,2[G,B,D]2 | D,,3[D,F,A,] D,,2[D,F,A,]2 | D,,3[D,F,A,] D,,2[D,F,A,]2 | G,,3[G,B,D] G,,2[G,B,D]2 | G,,3[G,B,D] G,,2[G,B,D]2 |
[V:0]|x8|x8|x8|x8|x8|x8|x8|x8| %10
[V:1]| FdFc FfFe| FdFc FfFe| GeGd GbGg|GeGd GeGd | FdFc FfFe| [de]dcd b2[cg]2 | [Bg]2gb gbgb | gbdg BdGB |
[V:2]| D,,3[D,F,A,] D,,2[D,F,A,]2 | D,,3[D,F,A,] D,,2[D,F,A,]2 | G,,3[G,B,D] G,,2[G,B,D]2 | G,,3[G,B,D] G,,2[G,B,D]2 | D,,3[D,F,A,] D,,2[D,F,A,]2 | D,,3[D,F,A,] D,,2[D,F,A,]2 | G,,3[G,B,D] G,,2[G,B,D]2 | G,,3[G,B,D] G,,2[G,B,D]2 |
[V:0]|x8|x8|x8|x8|x8|x8|x8|x8| %11
[V:1]| [DD,]2F,A, D2C2- | CD,F,A, D2C2- |CD,G,B, (D4| D)D,G,B, (D4| D)D,G,B, D2(C2 | C)D,F,A, D2C2 | B,2[DG]2 z B,CD | [DB]2[Ec]2[DB]2d2 |
[V:2]| D,,3[D,F,A,] D,,2[D,F,A,]2 | D,,3[D,F,A,] D,,2[D,F,A,]2 | G,,3[G,B,D] G,,2[G,B,D]2 | G,,3[G,B,D] G,,2[G,B,D]2 | D,,3[D,F,A,] D,,2[D,F,A,]2 | D,,3[D,F,A,] D,,2[D,F,A,]2 | G,,3[G,B,D] G,,2[G,B,D]2 | G,,3[G,B,D] G,,2[G,B,D]2 |
[V:0]|d8-|d8|d8-|d8|d8-|d8|x8|x8 !fine! |] %12
[V:1]| A,2C2A,2C2 | D2C2B,2A,2 | G,2D2B,2C2 | E2D2C2B,2 | A,2C2A,2C2 | D2C2B,2A,2 | B,2[B,DG]2 z B,CD | [DB]2[Ec]2[DGB]2 z2 |]
[V:2]| D,,3[D,F,A,] D,,2[D,F,A,]2 | D,,3[D,F,A,] D,,2[D,F,A,]2 | G,,3[G,B,D] G,,2[G,B,D]2 | G,,3[G,B,D] G,,2[G,B,D]2 | D,,3[D,F,A,] D,,2[D,F,A,]2 | D,,3[D,F,A,] D,,2[D,F,A,]2 | G,,3[G,B,D] G,,2[G,B,D]2 | z4 [G,B,D]2 z2 |]
V:3 accordionTab
| z+[5'78]4 z+z z+8 z+7 z+6 [| G+6 >+7' >+6 g+8 G+6 >+7' g+6 >+8 | D-6 >-8 >-6 d-8 D-6 >-a d-6 >-9 | D-6 >-8 >-6 d-8 D-6 >-a d-6 >-9 | G+6 >+7' >+6 g+8 G+6 >+a g+6 >+8' | G+6 >+7' >+6 g+8 G+6 >+7' g+6 >+8 | D-6 >-7' >-6 d-8 D-6 >-a d-6 >-9 |
| D-[67']2 >-[68] d-[>>] D-6'2 d-[78]2 | G+[67]2 >+8' g+a G+9 >+a g+9 >+a | G+9 >+a >+8 g+8' G+7 >+8 g+6 >+7 | D-6 >-7' >-6 d-8 D-6 >-a d-6 >-9 | D-6 >-7' >-6 d-8 D-6 >-a d-6 >-9 | G+6 >+7' >+6 g+8 G+6 >+a g+6 >+8' | G+6 >+7' >+6 g+8 G+6 >+7' g+6 >+8 |
| D-6 >-7' >-6 d-8 D-6 >-a d-6 >-9 | D-9 >-7' >-8 d-7' D-a'2 d-[8b]2 | G+[78']2 >+8' g+a G+9 >+a g+9 >+a | G+9 >+a >+8 g+8' G+7 >+8 g+6 >+7 | D-[13']2 >-2 d-3 D-3'2 d-42 | D-> >-1 >-2 d-3 D-3'2 d->2 | G-> >-1 >-1' g+4 G+52 g+>2 |
| G+> >+2 >+2' g+4 G-3'2 g->2 | D-> >-1 >-1' d-2' D-3'2 d-42 | D-> >-1 >-2 d-3 D-3'2 d-42 | G+42 >+[56] g+[>>] G+z >+4 g+3' >+5 || G+[57]2 >+[4'6'] g+[>>] G+[57]2 g-7'2 | D-> >-1 >-2 d-3 D-3'2 d-42 | D-> >-1 >-2 d-3 D-3'2 d-42 |
| G-> >-1 >-1' g+4 G+52 g+>2 | G+> >+2 >+2' g+4 G-3'2 g->2 | D-> >-1 >-1' d-2' D-3'2 d-42 | D-> >-1 >-2 d-3 D-3'2 d-42 | G+42 >+[56] g+[>>] G+z >+4 g+3' >+5 |: G+[57]2 >+[4'6'] g+[>>] G+[57]2 g+82 | D-[7'7]2 >-[>4] d-[>>] D-[>3]2 d-[>4]2 | D-[>3']2 >-[>4] d-[>>] D-[>2']2 d-[>3]2 |
| G+[83]2 >+[>5] g+[>>] G+[>4]2 g+[>3']2 | G+[>4']2 >+[>5] g+[>>] G+[>3']2 g+[>4]2 | D-[7'3]2 >-[>4] d-[>>] D-[>3]2 d-[>4]2 | D-[>3']2 >-[>4] d-[>>] D-[>2']2 d-[>3]2 |1 G+42 >+[455'] g+[>>>] G+z >+4 g+3' >+5 :|2 G+42 >+[455'] g+[>>>] G+z >+8 g+7 >+6 | G+[57]2 >+[4'6'] g+[>>] G+[57]2 g+82 |
| D-[7'3]2 >-[>4] d-[>>] D-[>3] >-[>3] d-[>4] >-[>4] | D-[>3']2 >-[>4] d-[>4] D-[>2'] >-[>2'] d-[>3] >-[>3] | G+[83]2 >+[>5] g+[>>] G+[>4] >+[>4] g+[>5] >+[>5] | G+[>4'] >+[>4'] >+[>5] g+[>>] G+[>3']2 g+[>4] >+[>4] | D-[7'3]2 >-[>4] d-[>>] D-[>3] >-[>3] d-[>4] >-[>4] | D-[>3']2 >-[>4] d-[>>] D-[>2']2 d-[>3]2 | G+42 >+[55'] g+[>>] G+z >+4 g+3' >+5 | G+[57]2 >+[4'6'] g+[>>] G+[57]2 g+82 |
| D-[7'3]2 >-[>4] d-[>>] D-[>3]2 d-[>4]2 | D-[>3']2 >-[>4] d-[>>] D-[>2']2 d-[>3]2 | G+[83]2 >+[>5] g+[>>] G+[>4]2 g+[>3']2 | G+[>4']2 >+[>5] g+[>>] G+[>3']2 g+[>4]2 | D-[7'3]2 >-[>4] d-[>>] D-[>3]2 d-[>4]2 | D-[>3']2 >-[>4] d-[>>] D-[>2']2 d-[>3]2 | G+42 >+[455'] g+[>>>] G+z >+8' g+8 >+7 | G+[677']2 >+[678] g+[>>>] G+[677']2 g+[678]2 |
| D-[677']2 >-[68] d-[>>] D-[67a]2 d-[5'89]2 | D-[677']2 >-[68] d-[>>] D-[67a]2 d-[5'89]2 | G+[677']2 >+[68] g+[>>] G+[678]2 g+[688']2 | G+[677']2 >+[678] g+[>>>] G+[677']2 g+[678]2 | D-[677']2 >-[68] d-[>>] D-[67a]2 d-[5'9]2 | (3 D-7' >-9 >-7' ) >-x d-7' D-[7'a']2 d-[8b]2 | G+[78']2 >+8' g+a G+9 >+a g+9 >+a | G+9 >+a >+8 g+8' G+7 >+8 g+6 >+7 |
| D-6 >-7' >-6 d-8 D-6 >-a d-6 >-9 | D-6 >-7' >-6 d-8 D-6 >-a d-6 >-9 | G+6 >+7' >+6 g+8 G+6 >+a g+6 >+8' | G+6 >+7' >+6 g+8 G+6 >+7' g+6 >+8 | D-6 >-7' >-6 d-8 D-6 >-a d-6 >-9 | D-[7'9] >-7' >-8 d-7' D-a'2 d-[89']2 | G+[78']2 >+8' g+a G+9 >+a g+9 >+a | G+9 >+a >+8 g+8' G+7 >+8 g+6 >+7 |
| D-[13']2 >-2 d-3 D-3'2 d-42 | D-> >-1 >-2 d-3 D-3'2 d-42 | G-> >-1 >-1' g+4 G+52 g+>2 | G+> >+2 >+2' g+4 G-3'2 g->2 | D-> >-1 >-1' d-2' D-3'2 d-42 | D-> >-1 >-2 d-3 D-3'2 d-42 | G+42 >+[55']  g+[>>] G+z >+4 g+3' >+5 | G+[57]2 >+[4'6'] g+[>>] G+[57]2 g+82 |
| D-[7'3]2 >-[>4] d-[>>] D-[>3]2 d-[>4]2 | D-[>3']2 >-[>4] d-[>>] D-[>2']2 d-[>3]2 | G+[83]2 >+[>5] g+[>>] G+[>4]2 g+[>3']2 | G+[>4']2 >+[>5] g+[>>] G+[>3']2 g+[>4]2 | D-[7'3]2 >-[>4] d-[>>] D-[>3]2 d-[>4]2 | D-[>3']2 >-[>4] d-[>>] D-[>2']2 d-[>3]2 | G+42 >+[455'] g+[>>>] G+z >+4 g+3' >+5 | z+[57]2 z+[4'6']2 g+[55'7]2 z+z2 |]
</textarea>
        
<div id="topBar" class="topBar gradiente" >
    <span class="topTitle">
        Draw the dots
        <i class="ico-cogs topSettings" ></i>
    </span>
    <div class="dropdown-group">
        <div id="menu1Div" class="topMenu"></div>
    </div>
</div> <!-- topBar -->
<div id="studioDiv" class="studio" > 
    <div id="editorDiv" class="editor" style="display:none;"> 
        <div id="controlDiv" class="editorControles">
            <span id="spanNomeGaita">Acordeons: </span>
            <select id="selGaitas" ></select>
            <select id="selKey" ></select>
            <input type="submit" id="maisOitava" value="+ Oitava" onclick="javascript:doTranspose(12);" />
            <input type="submit" id="menosOitava" value="- Oitava" onclick="javascript:doTranspose(-12);" />
            <input type="button" id="printBtn" value="Print Preview" />
            <input type="submit" id="forceRefresh" value="Refresh" onclick="javascript:doForceRefresh();" />
            <input type="checkbox" id="chkAutoRefresh" />Auto refresh 
            <input type="checkbox" id="chkDebug" onclick="javascript:doCheckDebug();" />Debug
            <input type="button" id="showMapBtn" value="Show Map" />
            <input type="button" id="switch_source" value="ABC/SVG" />
            <input type="button" id="playBtn" value="Play" />
            <input type="button" id="pauseBtn" value="Pause" />
            <input type="button" id="stopBtn" value="Stop" />
            <input type="button" id="textBtn" value="TextArea" />
            <input type="button" id="roBtn" value="R.O." />
            <label id="currentPlayTime" style="font-weight: bold; color: yellow; padding-left: 5px; padding-right: 3px;">00:00.00</label>
        </div>
    </div> <!-- editorDiv -->
</div>        
        <script type="text/javascript">
            
            window.addEventListener('load', loadAccordions, false);
            
            function loadAccordions() {
                
                MIDI.widget = new sketch.ui.Timer({size:180, cor1:'#ffffff', cor2:'#ffff88' });
                MIDI.widget.setFormat( 'Carregando...');
                MIDI.widget.setValue(1);

                DIATONIC.map.loadAccordionMaps(
                    [
                       'accordions/hohner.gc.accordion'
                      ,'accordions/hohner.cf.club.br.accordion'
                      ,'accordions/leticce.cf.ne.accordion'
                    ]
                    , function () { // call back after loading
                        FILEMANAGER.waitResources( { 
                            onProgress: function(event) {
                                if(event.success){
                                    MIDI.widget.setValue(0+Math.round(event.perc*.1));
                                    console.log('\nPercentual: '+ event.perc + '\nTimeouts: ' + event.timeouts + '\n' + event.success );
                                } else {
                                    MIDI.widget.setValue(0+Math.round(event.perc*.1));
                                    console.log('\nPercentual: '+ event.perc);
                                }
                            }
                            ,onLoad: loadMIDI 
                        });
                    } 
                );
            }
            
            function loadMIDI() {
                
                MIDI.widget.setValue(10);
                
                MIDI.loadPlugin({
                     soundfontUrl: "./soundfont/"
                    ,instruments: "accordion" // default
                    ,onprogress: function(event) {
                        MIDI.widget.setValue(10+Math.round(MIDI.getPercent(event)*.4));
                    }         
                    ,onprogress2: function( percent ) {
                        MIDI.widget.setValue(50+Math.round(percent*.5));
                    }        
                    ,callback: initApp
                });
            }
            
            
            
            function initApp() {
                
                console.log( 
                      '\nchromium: ' + ABCXJS.misc.isChromium() 
                    + '\nchrome: ' + ABCXJS.misc.isChrome() 
                    + '\nfirefox: ' + ABCXJS.misc.isFirefox()  
                    + '\nIE: ' + ABCXJS.misc.isIE() + '\n '
                );
                
                ypos = 0;
                lastYpos = 0;
                lastStaffGroup = null;
                debug = false;
                myEditor = {};

                player = new ABCXJS.midi.Player();
                
                
                playerCallBackOnPlay = function ( player ) {
                    cpt.innerHTML = player.getTime().cTime;
                };
                
                playerCallBackOnScroll = function ( player ) {
//                { // se possivel aplicar esta mesma lógica em playerCallBackOnScroll 
//                    var fixedTop = player.printer.staffgroups[0].top;
//                    var vp = this.studioCanvasDiv.clientHeight - fixedTop;
//                    var top = player.printer.staffgroups[player.currAbsElem.staffGroup].top;
//                    var bottom = top + player.printer.staffgroups[player.currAbsElem.staffGroup].height;
//
//                    if( bottom > vp+this.ypos || this.ypos > top-fixedTop ) {
//
//                        this.ypos = top;
//                        this.studioCanvasDiv.scrollTop = this.ypos;    
//                   }
//                }  
                
                    if( player.currAbsElem.staffGroup === lastStaffGroup )  return;
                    
                    lastStaffGroup = player.currAbsElem.staffGroup;
                    
                    var fixedTop = document.getElementById('editorDiv').clientHeight;
                    var wtop = document.getElementById('canvasDiv').offsetTop -
                               fixedTop;

                    var wh = window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight;                   

                    var vp = wh - fixedTop;
                        
                    var top = player.printer.staffgroups[player.currAbsElem.staffGroup].top;
                    var bottom = top + player.printer.staffgroups[player.currAbsElem.staffGroup].height;
                    
                    if( wtop+bottom > vp+window.ypos || window.ypos-wtop > top ) {
                        window.ypos = wtop + top;
                        window.scrollTo( 0, window.ypos );    
                    }
                };
                
                playerCallBackOnEnd = function (player) {
                    cpt.innerHTML = "00:00.00";
                    myEditor.printer.clearSelection();
                    var warns = player.getWarnings();
                    window.scrollTo( 0, 0 );
                    if( warns ) {
                        var txt = "";
                        warns.forEach(function(msg){ txt += msg + '<br>'; });
                        document.getElementById("warningsDiv").innerHTML = '<hr>'+txt;
                    }
                };
                
                editorCallbackOnChange = function ( editor ) {
                    window.scrollTo( 0, window.lastYpos );
                };
                
                player.defineCallbackOnEnd(playerCallBackOnEnd);
                player.defineCallbackOnPlay(playerCallBackOnPlay);
                player.defineCallbackOnScroll(playerCallBackOnScroll);
                
                myEditor = new ABCXJS.Editor(
                    {
                         menu_id: "menu1Div"
                        ,studio_id: "studioDiv"
                        ,canvas_id: "canvasDiv"
                        ,control_id: 'controlDiv'
                        ,warnings_id: "warningsDiv"
                        ,generate_warnings: true
                        
                        ,refreshController_id: "chkAutoRefresh"
                        ,keySelector_id: "selKey"
                        ,accordionSelector_id: "selGaitas"
                        ,accordionNameSpan: "spanNomeGaita"
                        ,generate_midi: true
                        ,generate_tablature: 'accordion'
                        ,accordion_options: {
                                 //id: 'GAITA_LETICCE_CF_NE'
                                 id: 'GAITA_HOHNER_GC'
                               //  id: 'GAITA_HOHNER_CLUB_IIIM_BR'
                                //,keyboardDiv_id:"keyboardDiv"
                                ,accordionMaps: DIATONIC.map.accordionMaps
                                ,render_keyboard_opts:{transpose:false, mirror: true, scale:1, draggable:false, show:false, label:false}}
                        ,midi_options: {program: 21, qpm: 150, type: "qt"}
                        ,render_options: {}
                        ,onchange: editorCallbackOnChange
                        ,gui: false
                    } );
                    
                m1 = new ABCXJS.edit.DropdownMenu(
                   'menu1Div'
                ,  { listener:myEditor, method:'menuCallback' }
                ,  [{title: 'Informações', ddmId: 'menuInformacoes',
                        itens: [
                            'Tutoriais <i class="ico-novo">|TUTORIAL',
                            'Partitura <i class="ico-play">Tablatura|PART2TAB',
                            'Tablatura <i class="ico-play">Partitura|TAB2PART',
                            'Sobre|ABOUT'
                        ]}
                ]);

                    
                myEditor.setString( document.getElementById("abc").value );
                myEditor.editarea.resize();
                    
                myEditor.fireChanged( 0, {force: true} );
                
            }

            function doTranspose(value) {
                var doc = document.documentElement;
                window.lastYpos = (window.pageYOffset || doc.scrollTop)  - (doc.clientTop || 0);                
                myEditor.fireChanged( value, {force: true} );
            };

            function doForceRefresh() {
                var doc = document.documentElement;
                window.lastYpos = (window.pageYOffset || doc.scrollTop)  - (doc.clientTop || 0);                
                myEditor.fireChanged( 0, {force: true} );
            };

            function doCheckDebug() {
                debug = document.getElementById("chkDebug").checked;
                var doc = document.documentElement;
                window.lastYpos = (window.pageYOffset || doc.scrollTop)  - (doc.clientTop || 0);                
                myEditor.fireChanged( 0, {force: true} );
            };

        </script>        
    </body>
    
</html>
